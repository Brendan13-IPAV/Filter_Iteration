<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IP First Response 2.0</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="header-content">
        <div class="logo">IP First Response 2.0</div>
        <nav class="nav">
          <a href="index.html">Home</a>
          <a href="#">About</a>
        </nav>
      </div>
    </div>
  </header>

  <div class="container main-content">
    <div id="app">Loading... Please wait while we prepare your options</div>
  </div>

  <footer class="footer">
    <div class="container">
      <p style="text-align: center; font-size: 14px;">&copy; 2025 IP Strategy Finder</p>
    </div>
  </footer>

  <script>
    Promise.all([
      fetch('strategies.json').then(res => res.json()),
      fetch('preferences.json').then(res => res.json()),
      fetch('scoring-matrix.json').then(res => res.json())
    ]).then(([strategiesData, preferenceConfigs, scoringMatrix]) => {
      window.preferenceConfigs = preferenceConfigs;

      function IPStrategyFinder() {
        const savedState = JSON.parse(localStorage.getItem('ipStrategyState')) || {};
        const selectedFromIndex = JSON.parse(localStorage.getItem('ipSelectedRights'));
        const allRights = ['Patent', 'Trade mark', 'Design', 'PBR', 'Copyright', 'Any'];

        const state = {
          loading: true,
          strategies: strategiesData,
          filteredStrategies: [],
          accordions: savedState.accordions || {},
          selectedRights: selectedFromIndex || savedState.selectedRights || allRights,
          selectedSituations: savedState.selectedSituations || ['Enforcement'],
          preferences: {},
          otherFactors: {},
          situationSpecificFilters: {},
          ipTypeSpecificFilters: {}
        };

        localStorage.removeItem('ipSelectedRights');

        function render() {
          localStorage.setItem('ipStrategyState', JSON.stringify({
            accordions: state.accordions,
            selectedRights: state.selectedRights,
            selectedSituations: state.selectedSituations
          }));

          const app = document.getElementById('app');
          app.innerHTML = '';

          const container = document.createElement('div');
          container.className = 'grid';
          const leftCol = document.createElement('div');

          const accordionPresets = {
            default: {
              'Your IP': ['Jurisdiction', 'YourTMStatus', 'YourPatStatus'],
              'Details': ['Where', 'onlineIssues', 'domainName', 'importingGoods'],
              'Other party details': ['theirIPRights', 'identifyParty'],
              'Resolution Preferences': ['desiredOutcome', 'preferedApproach', 'businessRelationship', 'opentToNegotiate']
            }
          };

          let activeAccordionLayout = accordionPresets.default;

          Object.entries(activeAccordionLayout).forEach(([group, filters]) => {
            leftCol.appendChild(renderCustomAccordion(group, filters));
          });

          const rightCol = document.createElement('div');
          rightCol.appendChild(document.createElement('h2')).textContent = 'Filtered strategies will appear here';
          container.appendChild(leftCol);
          container.appendChild(rightCol);
          app.appendChild(container);
        }

        function renderCustomAccordion(groupLabel, filterKeys) {
          const wrapper = document.createElement('div');
          const title = document.createElement('h3');
          title.textContent = groupLabel;
          wrapper.appendChild(title);

          filterKeys.forEach(key => {
            const config = preferenceConfigs.filters[key];
            if (!config) return;

            const group = document.createElement('div');
            group.className = 'preference-group';
            const label = document.createElement('label');
            label.textContent = config.label;
            group.appendChild(label);

            const radioGroup = document.createElement('div');
            config.options.forEach(opt => {
              const radio = document.createElement('label');
              radio.className = 'radio-button';
              radio.textContent = opt.label;
              radio.onclick = () => {
                state.preferences[key] = opt.label;
                render();
              };
              radioGroup.appendChild(radio);
            });

            group.appendChild(radioGroup);
            wrapper.appendChild(group);
          });

          return wrapper;
        }

        return { init: () => { state.loading = false; render(); } };
      }

      IPStrategyFinder().init();
    }).catch(err => {
      console.error('Error loading data:', err);
      document.getElementById('app').textContent = 'Failed to load data.';
    });
  </script>
</body>
</html>
